<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>لوحة تحكم الأدمن - إدارة محاولات المستخدمين</title>
    <style>
        body {
            background: #1a1a32;
            color: #f4faff;
            font-family: 'Cairo', Tahoma, Arial, sans-serif;
            margin: 0; padding: 0;
        }
        .admin-panel {
            max-width: 500px;
            margin: 30px auto;
            background: #232946;
            border-radius: 18px;
            box-shadow: 0 6px 32px #000a;
            padding: 26px 18px 22px 18px;
        }
        h2 {
            color: #00ffd0;
            margin-bottom: 12px;
        }
        input, button, select {
            font-size: 1.05rem;
            padding: 7px 13px;
            margin: 4px 0;
            border-radius: 7px;
            border: none;
            outline: none;
        }
        input, select { width: 70%; }
        button {
            background: linear-gradient(90deg, #00ffd0, #ffe066);
            color: #232946;
            font-weight: bold;
            cursor: pointer;
            margin: 7px 2px;
            border-bottom: 2.5px solid #ffe066aa;
        }
        .users-list {
            margin-top: 18px;
        }
        table {
            width: 100%;
            background: #1a1a32;
            border-radius: 10px;
            margin-top: 8px;
            border-collapse: collapse;
        }
        th, td {
            padding: 7px 5px;
            text-align: center;
        }
        th {
            background: #232946;
            color: #ffe066;
        }
        tr:nth-child(even) { background: #23294644;}
        tr:hover { background: #23294666;}
        .admin-actions button {
            font-size: 0.95em;
            padding: 5px 12px;
            margin: 0 2px;
        }
        .msg {
            margin: 12px 0 0 0;
            font-size: 1.09em;
            color: #ffe066;
        }
    </style>
</head>
<body>
    <div class="admin-panel">
        <h2>👑 لوحة تحكم الأدمن</h2>
        <form id="userForm" onsubmit="return false;">
            <input type="text" id="userIdInput" placeholder="معرف المستخدم (userId)">
            <input type="number" min="0" id="attemptsInput" placeholder="عدد المحاولات">
            <button onclick="setAttempts()">تعيين المحاولات</button>
            <button onclick="restoreAttempt()">إرجاع محاولة (1)</button>
            <button onclick="resetAttempts()">تصفير المحاولات (0)</button>
        </form>
        <div class="msg" id="msg"></div>
        <div class="users-list" id="usersList"></div>
    </div>
<script>
// --- إدارة المحاولات ---
function setUserAttempts(userId, value) {
    let users = localStorage.getItem("gameAttemptsUsers");
    users = users ? JSON.parse(users) : {};
    users[userId] = value;
    localStorage.setItem("gameAttemptsUsers", JSON.stringify(users));
}
function getUserAttempts(userId) {
    let users = localStorage.getItem("gameAttemptsUsers");
    users = users ? JSON.parse(users) : {};
    return typeof users[userId] === "undefined" ? 1 : users[userId];
}
function resetUserAttempts(userId) { setUserAttempts(userId, 0); }
function restoreUserAttempt(userId) { setUserAttempts(userId, 1); }
function getAllUsers() {
    let users = localStorage.getItem("gameAttemptsUsers");
    users = users ? JSON.parse(users) : {};
    return users;
}
function deleteUser(userId) {
    let users = localStorage.getItem("gameAttemptsUsers");
    users = users ? JSON.parse(users) : {};
    delete users[userId];
    localStorage.setItem("gameAttemptsUsers", JSON.stringify(users));
}

// --- واجهة الأدمن ---
function setAttempts() {
    let userId = document.getElementById('userIdInput').value.trim();
    let val = Number(document.getElementById('attemptsInput').value);
    if (!userId || isNaN(val) || val < 0) {
        showMsg("أدخل معرف وعدد محاولات صحيح.");
        return false;
    }
    setUserAttempts(userId, val);
    showMsg("تم تعيين " + val + " محاولة للمستخدم " + userId);
    refreshUsers();
    return false;
}
function restoreAttempt() {
    let userId = document.getElementById('userIdInput').value.trim();
    if (!userId) { showMsg("أدخل معرف المستخدم!"); return false; }
    restoreUserAttempt(userId);
    showMsg("تم إرجاع محاولة واحدة للمستخدم " + userId);
    refreshUsers();
    return false;
}
function resetAttempts() {
    let userId = document.getElementById('userIdInput').value.trim();
    if (!userId) { showMsg("أدخل معرف المستخدم!"); return false; }
    resetUserAttempts(userId);
    showMsg("تم تصفير المحاولات للمستخدم " + userId);
    refreshUsers();
    return false;
}
function showMsg(msg) {
    let el = document.getElementById('msg');
    el.textContent = msg;
    setTimeout(()=>{el.textContent=''}, 3200);
}
function refreshUsers() {
    let users = getAllUsers();
    let html = "<h3>كل المستخدمين المسجلين</h3>";
    let keys = Object.keys(users);
    if (keys.length === 0) {
        html += "<div>لا يوجد مستخدمين بعد.</div>";
    } else {
        html += `<table>
            <tr><th>معرف المستخدم</th><th>عدد المحاولات</th><th>إجراءات</th></tr>`;
        keys.forEach(userId => {
            html += `<tr>
                <td>${userId}</td>
                <td>${users[userId]}</td>
                <td class="admin-actions">
                    <button onclick="restoreUserAttempt('${userId}');refreshUsers();">1 محاولة</button>
                    <button onclick="resetUserAttempts('${userId}');refreshUsers();">تصفير</button>
                    <button onclick="deleteUser('${userId}');refreshUsers();">حذف</button>
                </td>
            </tr>`;
        });
        html += "</table>";
    }
    document.getElementById('usersList').innerHTML = html;
}
window.restoreUserAttempt = restoreUserAttempt;
window.resetUserAttempts = resetUserAttempts;
window.deleteUser = deleteUser;
window.refreshUsers = refreshUsers;

document.addEventListener('DOMContentLoaded', refreshUsers);
</script>
</body>
</html>
