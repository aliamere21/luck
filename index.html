<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª + Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</title>
    <style>
        body {
            background: #1a1a32;
            color: #f4faff;
            font-family: 'Cairo', Tahoma, Arial, sans-serif;
            margin: 0; padding: 0;
        }
        .container, .admin-panel {
            max-width: 500px;
            margin: 30px auto 0 auto;
            background: #232946;
            border-radius: 18px;
            box-shadow: 0 6px 32px #000a;
            padding: 26px 18px 22px 18px;
        }
        .container {
            margin-top: 15px;
        }
        h2, h3 {
            color: #00ffd0;
        }
        input, button, select {
            font-size: 1.05rem;
            padding: 7px 13px;
            margin: 4px 0;
            border-radius: 7px;
            border: none;
            outline: none;
        }
        input, select { width: 74%; }
        button {
            background: linear-gradient(90deg, #00ffd0, #ffe066);
            color: #232946;
            font-weight: bold;
            cursor: pointer;
            margin: 7px 2px;
            border-bottom: 2.5px solid #ffe066aa;
        }
        .users-list {
            margin-top: 18px;
        }
        table {
            width: 100%;
            background: #1a1a32;
            border-radius: 10px;
            margin-top: 8px;
            border-collapse: collapse;
        }
        th, td {
            padding: 7px 5px;
            text-align: center;
        }
        th {
            background: #232946;
            color: #ffe066;
        }
        tr:nth-child(even) { background: #23294644;}
        tr:hover { background: #23294666;}
        .admin-actions button {
            font-size: 0.95em;
            padding: 5px 12px;
            margin: 0 2px;
        }
        .msg {
            margin: 12px 0 0 0;
            font-size: 1.09em;
            color: #ffe066;
        }
        .code-col {
            font-family: "Consolas", "Cairo", monospace;
            color: #00ffd0;
            font-weight: bold;
            direction: ltr;
        }
    </style>
</head>
<body>
<div class="container">
    <h2>ğŸ® Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</h2>
    <div>
        <input type="text" id="userId" placeholder="Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (userId)">
        <input type="text" id="userCode" placeholder="Ø±Ù…Ø² Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Code)">
        <button onclick="checkAttempts()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</button>
    </div>
    <div id="status" style="margin:17px 0 14px 0; font-size: 1.13rem; font-weight:bold"></div>
    <div style="margin-top:14px; color:#ffe066b3; font-size:0.99rem;">
        * ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù‡ Ù…Ø­Ø§ÙˆÙ„Ø© ÙˆØ§Ø­Ø¯Ø© + Ø±Ù…Ø².<br>
        * Ø¥Ø°Ø§ Ø§Ù†ØªÙ‡Øª Ù…Ø­Ø§ÙˆÙ„ØªÙƒ ØªØµÙŠØ± 0.<br>
        * Ø¥Ø°Ø§ ÙˆØ¶Ø¹ Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© = 1 ØªØ±Ø¬Ø¹.<br>
        * Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† ØªØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙˆØ§Ù„Ø±Ù…Ø².<br>
        * Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¶Ø§Ù ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ø¯Ø®ÙˆÙ„ ØµØ­ÙŠØ­.<br>
    </div>
</div>
<div class="admin-panel">
    <h3>ğŸ‘‘ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†</h3>
    <form id="userForm" onsubmit="return false;">
        <input type="text" id="adminUserId" placeholder="Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (userId)">
        <input type="text" id="adminUserCode" placeholder="Ø±Ù…Ø² Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Code)">
        <input type="number" min="0" id="attemptsInput" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª">
        <button onclick="setAttempts()">ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª/Ø±Ù…Ø²</button>
        <button onclick="restoreAttempt()">Ø¥Ø±Ø¬Ø§Ø¹ Ù…Ø­Ø§ÙˆÙ„Ø© (1)</button>
        <button onclick="resetAttempts()">ØªØµÙÙŠØ± Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª (0)</button>
    </form>
    <div class="msg" id="msg"></div>
    <div class="users-list" id="usersList"></div>
</div>
<script>
// ========== DATA STRUCTURE =========
// usersData = { userId: {code: ..., attempts: ...}, ... }
function getAllUsers() {
    let users = localStorage.getItem("gameAttemptsUsers");
    users = users ? JSON.parse(users) : {};
    return users;
}
function saveAllUsers(users) {
    localStorage.setItem("gameAttemptsUsers", JSON.stringify(users));
}
function getUser(userId) {
    let users = getAllUsers();
    return users[userId] || null;
}
function setUser(userId, code, attempts) {
    let users = getAllUsers();
    users[userId] = { code: code, attempts: attempts };
    saveAllUsers(users);
}
function setUserAttempts(userId, attempts) {
    let users = getAllUsers();
    let user = users[userId] || {code:'', attempts:1};
    user.attempts = attempts;
    users[userId] = user;
    saveAllUsers(users);
}
function setUserCode(userId, code) {
    let users = getAllUsers();
    let user = users[userId] || {code:'', attempts:1};
    user.code = code;
    users[userId] = user;
    saveAllUsers(users);
}
function resetUserAttempts(userId) {
    setUserAttempts(userId, 0);
}
function restoreUserAttempt(userId) {
    setUserAttempts(userId, 1);
}
function deleteUser(userId) {
    let users = getAllUsers();
    delete users[userId];
    saveAllUsers(users);
}

// ========== PLAYER SECTION ==========
function checkAttempts() {
    let userId = document.getElementById('userId').value.trim();
    let userCode = document.getElementById('userCode').value.trim();
    if (!userId || !userCode) {
        showStatus("Ø±Ø¬Ø§Ø¡Ù‹ Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ø±Ù…Ø²!", true);
        return;
    }
    let user = getUser(userId);

    // --- ÙŠØ¶Ø§Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯ ---
    if (!user) {
        setUser(userId, userCode, 1);
        user = { code: userCode, attempts: 1 };
        showStatus("ğŸŸ¢ ØªÙ… ØªØ³Ø¬ÙŠÙ„Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ù„Ø¯ÙŠÙƒ Ù…Ø­Ø§ÙˆÙ„Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ù„Ø¹Ø¨.", false);
        refreshUsers();
        return;
    }
    // -------------------------------------

    // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù…Ø²
    if (user.code !== userCode) {
        showStatus("âŒ Ø±Ù…Ø² Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± ØµØ­ÙŠØ­!", true);
        return;
    }
    if (user.attempts > 0) {
        setUserAttempts(userId, user.attempts - 1);
        showStatus("âœ… ØªØ³ØªØ·ÙŠØ¹ Ø§Ù„Ù„Ø¹Ø¨! (Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¢Ù†: " + (user.attempts - 1) + ")", false);
        refreshUsers();
    } else {
        showStatus("âŒ Ø§Ù†ØªÙ‡Øª Ù…Ø­Ø§ÙˆÙ„ØªÙƒ! Ø§Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ø£Ø¯Ù…Ù† Ø¥Ø±Ø¬Ø§Ø¹Ù‡Ø§.", true);
    }
}
function showStatus(msg, isErr) {
    let el = document.getElementById('status');
    el.textContent = msg;
    el.style.color = isErr ? "#ff2255" : "#00ffd0";
}

// ========== ADMIN SECTION ==========
function setAttempts() {
    let userId = document.getElementById('adminUserId').value.trim();
    let userCode = document.getElementById('adminUserCode').value.trim();
    let val = Number(document.getElementById('attemptsInput').value);
    if (!userId || !userCode || isNaN(val) || val < 0) {
        showMsg("Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø±ÙØŒ Ø±Ù…Ø² ÙˆØ¹Ø¯Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª ØµØ­ÙŠØ­.");
        return false;
    }
    setUser(userId, userCode, val);
    showMsg("ØªÙ… ØªØ¹ÙŠÙŠÙ† " + val + " Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… " + userId + " Ø¨Ø±Ù…Ø² ["+userCode+"]");
    refreshUsers();
    return false;
}
function restoreAttempt() {
    let userId = document.getElementById('adminUserId').value.trim();
    let user = getUser(userId);
    if (!userId || !user || !user.code) { showMsg("Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø±Ù Ù…Ø³ØªØ®Ø¯Ù… ØµØ­ÙŠØ­ Ù…ÙˆØ¬ÙˆØ¯!"); return false; }
    restoreUserAttempt(userId);
    showMsg("ØªÙ… Ø¥Ø±Ø¬Ø§Ø¹ Ù…Ø­Ø§ÙˆÙ„Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… " + userId);
    refreshUsers();
    return false;
}
function resetAttempts() {
    let userId = document.getElementById('adminUserId').value.trim();
    let user = getUser(userId);
    if (!userId || !user || !user.code) { showMsg("Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø±Ù Ù…Ø³ØªØ®Ø¯Ù… ØµØ­ÙŠØ­ Ù…ÙˆØ¬ÙˆØ¯!"); return false; }
    resetUserAttempts(userId);
    showMsg("ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… " + userId);
    refreshUsers();
    return false;
}
function showMsg(msg) {
    let el = document.getElementById('msg');
    el.textContent = msg;
    setTimeout(()=>{el.textContent=''}, 3200);
}
function refreshUsers() {
    let users = getAllUsers();
    let html = "<h3>ÙƒÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</h3>";
    let keys = Object.keys(users);
    if (keys.length === 0) {
        html += "<div>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ø¹Ø¯.</div>";
    } else {
        html += `<table>
            <tr><th>Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th><th>Ø§Ù„Ø±Ù…Ø²</th><th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr>`;
        keys.forEach(userId => {
            let user = users[userId];
            html += `<tr>
                <td>${userId}</td>
                <td class="code-col">${user.code}</td>
                <td>${user.attempts}</td>
                <td class="admin-actions">
                    <button onclick="restoreUserAttempt('${userId}');refreshUsers();">1 Ù…Ø­Ø§ÙˆÙ„Ø©</button>
                    <button onclick="resetUserAttempts('${userId}');refreshUsers();">ØªØµÙÙŠØ±</button>
                    <button onclick="deleteUser('${userId}');refreshUsers();">Ø­Ø°Ù</button>
                </td>
            </tr>`;
        });
        html += "</table>";
    }
    document.getElementById('usersList').innerHTML = html;
}
window.restoreUserAttempt = restoreUserAttempt;
window.resetUserAttempts = resetUserAttempts;
window.deleteUser = deleteUser;
window.refreshUsers = refreshUsers;

document.addEventListener('DOMContentLoaded', refreshUsers);
</script>
</body>
</html>
